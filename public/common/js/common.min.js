window.initStats=0,function(t,e){e.init=function(){if(window.initStats)return!1;t("[data-dux]").each(function(){var e=t(this).data(),n=e.dux.split("-",2);window[n[0]][n[1]]&&"function"==typeof window[n[0]][n[1]]?window[n[0]][n[1]](this,e):app.debug(n[0]+"组件中不存在"+n[1]+"方法!")}),void 0!=window.windowAfter&&""!=window.windowAfter&&window.windowAfter(),window.initStats=1},e.bind=function(e){t(e).find("[data-dux]").each(function(){var e=t(this).data(),n=e.dux.split("-",2);window[n[0]][n[1]](this,e)})}}(jQuery,window.dux={}),function(t,e){var n=[];e.loading=function(e,n){var a=t.extend({msg:"加载中...",status:!0},{msg:e,status:n}),i='<div class="dux-loading"><div class="loading-mask"></div><div class="loading-body"><div class="loading-icon"></div><div class="loading-msg">'+a.msg+"</div></div></div>";if(a.status){if(t(".dux-loading").length)return!1;t(i).appendTo("body")}else setTimeout(function(){t(".dux-loading").remove()},100)},e.msg=function(e,n){var a=t.extend({msg:"加载中",time:3},{msg:e,time:n}),i='<div class="dux-msg-layout"><div class="dux-msg"><div class="text">'+a.msg+"</div></div></div>";t(".dux-msg-layout").length&&t(".dux-msg-layout").remove(),t(i).appendTo("body"),setTimeout(function(){t(".dux-msg-layout").remove()},1e3*a.time)},e.ajax=function(n){t(n).click(function(){var n=t(this).data();e.confirm({title:n.title,callback:[function(){app.ajax({url:n.url,type:"post",data:n.params,success:function(t,e){var a=n.callback;void 0!=a&&""!=a?window[a](t,e):location.reload()},error:function(t,e){app.error(t,e)}})}]})})},e.confirm=function(e){e=t.extend({title:"询问",btn:["确认","取消"],callback:[]},e),UIkit.modal.confirm(e.title,{labels:{ok:e.btn[0],cancel:e.btn[1]}}).then(e.callback[0],e.callback[1])},e.open=function(e,a){a=t.extend({width:"",height:"400px"},a);var i=function(t,e){var i=UIkit.modal.dialog('<button class="uk-modal-close-default" type="button" uk-close></button>\n        <div class="uk-modal-header">\n            <h2 class="uk-modal-title">'+a.title+'</h2>\n        </div><iframe src="'+t+'" width="100%" height="'+e+'" frameborder="0"></iframe>',{cls:a.width?"uk-open uk-modal-container":"uk-open"});n.push(i)};e?t(e).on("click",function(){i(a.url,a.height)}):i(a.url,a.height)},e.close=function(){for(var e in n)n[e].hide();t(".dux-msg-layout").remove()},e.alert=function(t){UIkit.modal.alert(t.title,{labels:{ok:t.btn?t.btn:"确认"}}).then(function(){"function"==typeof t.callback&&t.callback()})}}(jQuery,window.dialog={}),function($,owner){owner.bind=function($el,config){var defaultConfig={advanced:!0};config=$.extend(defaultConfig,config),Do("form",function(){var options={dataType:"json",beforeSubmit:function(){$($el).find("button[type=submit]").prepend('<i class="fa fa-circle-o-notch fa-spin"></i> '),$($el).find("button").attr("disabled",!0)},uploadProgress:function(t,e,n,a){},complete:function(){$($el).find("button").attr("disabled",!1),$($el).find("button[type=submit]").find("i:first-child").remove()},success:function(t){var e=t.message,n=t.url;"function"!=typeof config.callback?"string"!=typeof config.callback?n?config.advanced?dialog.confirm({title:e,btn:["返回","继续"],callback:[function(){window.location.href=n},function(){location.reload()}]}):dialog.alert({title:e,callback:function(){window.location.href=n}}):config.advanced?notify.success({content:e}):dialog.alert({title:e,callback:function(){location.reload()}}):window[config.callback](e,n):config.callback(e,n)},error:function(e){var json=eval("("+e.responseText+")"),msg=json.message,url=json.url;config.advanced?notify.error({content:msg}):app.error(msg,url)}};$($el).ajaxForm(options),$($el).find("button").attr("disabled",!1)})},owner.date=function(t,e){Do("date",function(){var n={elem:t};e=$.extend(n,e),laydate.render(e)})},owner.location=function(t,e){e=$.extend({},e),Do("distpicker",function(){$(t).distpicker(e)})},owner.editor=function(t,e){var n={height:550,remoteLabel:"duxup_",url:rootUrl+"/"+roleName+"/system/Upload/editor",remoteUrl:rootUrl+"/"+roleName+"/system/Upload/remote"};e=$.extend(n,e),Do("editor",function(){tinymce.init({target:$(t)[0],images_upload_handler:function(t,n,a){const i=new FormData;i.append("upload",t.blob()),i.append("allowSize",100),$.ajax({url:e.url,type:"POST",data:i,dataType:"json",processData:!1,contentType:!1,success:t=>{t.error?(a(t.message),reject(t.message)):n(t.url)}})},init_instance_callback:function(e){e.on("Change",function(n){$(t).val(e.getContent())})},setup:function(t){t.ui.registry.addButton("xiumi",{text:"秀米",onAction:function(){dialog.open("",{width:"1080px",height:"600px",title:"秀米编辑器",url:rootUrl+"/public/common/js/package/xiumi/index.html"})}}),t.ui.registry.addButton("multipleUpload",{text:"上传",onAction:function(){owner.fileManage({multiple:!0,callback:function(t){var e=tinymce.activeEditor;switch(t.ext){case"jpg":case"png":case"bmp":case"jpeg":case"gif":e.insertContent('<img src="'+t.url+'" alt="'+t.title+'" />');break;case"wmv":case"mp4":case"flv":case"ogg":case"avi":case"mpg":case"mp3":case"wav":e.insertContent('<video src="'+t.url+'" controls="controls">'+t.title+"</video>");break;default:e.insertContent('<a href="'+t.url+'">'+t.title+"</a>")}}})}})},plugins:["advlist autolink link image lists preview hr pagebreak ","searchreplace visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table directionality paste"],height:e.height,toolbar:"formatselect | bold italic strikethrough forecolor backcolor | link image | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | removeformat | xiumi multipleUpload",language:"zh_CN",paste_webkit_styles:"all",paste_retain_style_properties:"all",paste_word_valid_elements:"*[*]",paste_convert_word_fake_lists:!1,paste_data_images:!0,convert_urls:!1,paste_preprocess:function(t,n){var a=tinymce.activeEditor;a.notificationManager.open({text:"粘贴处理中，请稍等...",type:"error"});var i=n.content,o=[];n.content="";for(l=/<img [^>]*src=['"]([^'"]+)[^>]*>/gi;tem=l.exec(i);)o.push(tem[1]);for(var l=/url\s*\(([^\)]+)\)/gim,r=new RegExp("(\"|'|&quot;)","g");tem=l.exec(i);){var s=tem[1];s=s.replace(r,""),o.push(s)}var c=[];for(var d in o){var u=o[d];u.indexOf(this.remoteDomain)<0&&(u.indexOf("http://")>=0||u.indexOf("https://")>=0)&&c.push(u)}if(c.length<=0)return a.notificationManager.close(),a.insertContent(i),!0;c.length>0&&$.ajax({url:e.remoteUrl,type:"POST",data:{files:c,label:e.remoteLabel},dataType:"json",success:function(t){if(1==t.error)return a.insertContent(i),a.notificationManager.close(),void a.notificationManager.open({text:t.message,type:"error",timeout:2e3});for(var e in c){var n=c[e];n=(n=(n=(n=(n=n.replace(/\//g,"\\/")).replace(/\./g,"\\.")).replace(/\?/g,"\\?")).replace(/\-/g,"\\-")).replace(/\=/g,"\\=");var o=new RegExp(n,"g");i=i.replace(o,t.files[e])}a.insertContent(i),a.setMode("design"),a.notificationManager.close(),a.notificationManager.open({text:"图片保存成功！",type:"success",timeout:2e3})},error:function(t){a.insertContent(i),a.notificationManager.close(),a.notificationManager.open({text:"图片保存失败！",type:"error",timeout:2e3})}})}})})},owner.fileManage=function(t){var e={url:rootUrl+"/"+roleName+"/system/Upload/attach",target:"",multiple:!1,type:"all",callback:{}};t=$.extend(e,t);var n=[],a=null,i=1,o=0,l=function(e){n=[],app.ajax({url:t.url,data:{page:i,type:t.type},loading:!0,success:function(t){var n=t.list;if(o=t.pageData.page,a.find(".dux-attach-box").html(""),n.length<=0)a.find(".dux-attach-box").html('<div class="uk-padding uk-text-center" style="width: 100%">没有该类型文件</div>');else for(var i in n){var l=$('<div class="attach-item"><div class="item-image"><img src=""></div><div class="item-title"><div></div></div></div>');l.find(".item-image img").attr("src",n[i].src),l.find(".item-image img").data("url",n[i].url),l.find(".item-image img").data("ext",n[i].ext),l.find(".item-image img").attr("title",n[i].title+"."+n[i].ext),l.find(".item-title").text(n[i].title+"."+n[i].ext),l.find(".item-title").attr("title",n[i].title+"."+n[i].ext),l.find(".item-title").data("title",n[i].title),a.find(".dux-attach-box").append(l)}e&&e()}})};a=$('<div><div class="uk-modal-dialog">\n        <div class="uk-modal-header uk-flex" style=" padding: 10px">\n            <div class="uk-flex-1 uk-form  uk-form-inline" style="padding-top: 0;">\n                <div class="uk-form-group">\n                    <select class="uk-select" data-type>\n                        <option value="all" selected>全部附件</option>\n                        <option value="image">图片</option>\n                        <option value="media">媒体</option>\n                        <option value="document">文档</option>\n                        <option value="other">其他</option>\n                    </select>\n                </div>\n                <div class="uk-form-group">\n                    <button type="button" data-search class="uk-button uk-button-primary"><i class="fa fa-search"></i></button>\n                </div>\n            </div>\n            <div>\n                <button type="button" class="uk-button uk-button-primary" data-upload>上传</button>\n            </div>\n        </div>\n        <div class="dux-attach-box"><div class="uk-padding uk-text-center" style="width: 100%">加载中...</div></div>\n        <div class="uk-modal-footer uk-flex" style=" padding: 10px">\n            <div class="uk-flex-1">\n                <button type="button" class="uk-button uk-button-default" data-page data-page-prev>上一页</button>\n                <button type="button" class="uk-button uk-button-default" data-page data-page-next>下一页</button>\n            </div>\n            <div>\n                <a href="JavaScript:;" class="uk-button uk-button-success" data-complete>确定</a>\n            </div>\n        </div>\n    </div></div>'),i=1,$(a).on("hidden",function(){$(a).remove()}),$(a).find("[data-type]").val(t.type),"all"!==t.type&&$(a).find("[data-type]").attr("disabled",!0),$(a).on("click",".attach-item",function(){var e=$(this).find("img").data("url"),a=$(this).find("img").data("ext"),i={url:e,title:$(this).find(".item-title").data("title"),ext:a};if(t.multiple)if($(this).hasClass("active")){$(this).removeClass("active");var o=$.inArray(i,n);n.splice(o,1)}else $(this).addClass("active"),n.push(i);else $(this).hasClass("active")?($(this).removeClass("active"),n=[]):($(this).parents(".dux-attach-box").find(".active").removeClass("active"),$(this).addClass("active"),n=[i])}),$(a).on("click","[data-complete]",function(){for(var e in n)t.target&&$(t.target).val(n[e].url),"function"==typeof t.callback&&t.callback(n[e]),"string"==typeof t.callback&&t.callback&&window[t.callback](n[e]),UIkit.modal(a).hide()}),$(a).on("click","[data-page-prev]",function(){var t=i-1;i=t>0?t:1,$(a).find("[data-page]").attr("disabled",!1),i<=1?$(a).find("[data-page-prev]").attr("disabled",!0):$(a).find("[data-page-prev]").attr("disabled",!1),l()}),$(a).on("click","[data-page-next]",function(){var t=i+1;i=t<o?t:o,$(a).find("[data-page]").attr("disabled",!1),i>=o?$(a).find("[data-page-next]").attr("disabled",!0):$(a).find("[data-page-next]").attr("disabled",!1),l()}),$(a).on("click","[data-search]",function(){i=0,t.type=$(a).find("[data-type]").val(),l()}),l(function(){var e="*";"image"==t.type&&(e="jpg,png,bmp,jpeg,gif"),"media"==t.type&&(e="wmv,mp4,flv,ogg,avi,mpg,mp3,wav"),"document"==t.type&&(e="doc,docx,xls,xlsx,pptx,ppt,csv"),form.upload($(a).find("[data-upload]"),{type:e,callback:function(){i=0,l()}}),UIkit.modal(a).show()})},owner.ckeditor=function(t,e){e=$.extend({height:550},e);var n=$(t).html();$(t).addClass("dux-editor"),$(t).html(""),Do("ckeditor",function(){class a{constructor(t){this.loader=t}upload(){return new Promise((t,e)=>{const n=new FormData;n.append("upload",this.loader.file),n.append("allowSize",100),$.ajax({url:rootUrl+"/"+roleName+"/system/Upload/editor",type:"POST",data:n,dataType:"json",processData:!1,contentType:!1,success:n=>{n.error?e(n.message):t({default:n.url})}})})}}$(t).append('<div class="toolbar-container"></div>'),$(t).append('<div class="content-container"><div class="content-editor">'+n+'</div><textarea name="'+e.name+'" rows="10" style="display: none">'+n+"</textarea></div>"),DecoupledEditor.create(t.querySelector(".content-editor"),{autosave:{save:e=>$(t).find("textarea").val(e.getData())}}).then(n=>{$(t).find(".toolbar-container").prepend(n.ui.view.toolbar.element),n.ui.view.editable.editableElement.style.minHeight=e.height+"px",n.plugins.get("FileRepository").createUploadAdapter=(t=>new a(t,n))}).catch(t=>{console.error(t)})})},owner.tags=function(t,e){e=$.extend({},e),Do("tags",function(){$(t).tagsInput(e)})},owner.select=function(t,e){e=$.extend({language:"zh-CN"},e),Do("select2",function(){if($.fn.select2.defaults.set("theme","uikit"),e.search){var n={ajax:{url:e.url,dataType:"json",delay:250,data:function(t){return{q:t.term,page:t.page}},processResults:function(t,e){return e.page=e.page||1,{results:t.items,pagination:{more:30*e.page<t.total_count}}},cache:!1},escapeMarkup:function(t){return t},minimumInputLength:2,templateResult:function(t){if(t.loading)return t.value||t.text;var e="<div class='select2-result-repository uk-clearfix'><div class='select2-result-repository__meta'><div class='select2-result-repository__title'>"+t.text+"</div>";return e+=(t.desc,t.desc),e+="</div></div>"},templateSelection:function(t){return"function"==typeof e.callback&&e.callback(t),"string"==typeof e.callback&&e.callback&&window[e.callback](t),t.text}};e=$.extend(e,n)}$(t).select2(e)})},owner.upload=function(t,e){var n={url:rootUrl+"/"+roleName+"/system/Upload/index",type:"*",size:0,num:0,multi:!0,resize:{},target:"",preview:"",callback:"",relative:"false",progress:""};e=$.extend(n,e);var a;Do("upload",function(){(a=new plupload.Uploader({runtimes:"html5,html4",browse_button:$(t).get(0),url:e.url,filters:{mime_types:[{title:"指定文件",extensions:e.type}]},max_file_size:e.size,multipart:e.multi,resize:e.resize,init:{PostInit:function(){},FilesAdded:function(n,i){if(e.num>0&&n.files.length>e.num)return dialog.msg("超过上传数量限制!"),void a.removeFile(i);$(t).attr("disabled",!0).append(' <span class="prs">[<strong>0%</strong>]</span>'),a.start()},UploadProgress:function(n,a){$(t).find("span").text(a.percent+"%"),"string"==typeof e.progress&&e.progress&&window[e.progress].call(t,a.percent)},FileUploaded:function(n,a,i){var o=JSON.parse(i.response);o.status?(e.target&&$(e.target).val(o.data.url),e.preview&&$(e.preview).attr("src",o.data.url),"function"==typeof e.callback&&e.callback.call(t,o.data),"string"==typeof e.callback&&e.callback&&window[e.callback].call(t,o.data)):dialog.msg(o.info)},Error:function(e,n){$(t).attr("disabled",!1).find("span").remove(),dialog.msg(n.message)},UploadComplete:function(e,n){$(t).attr("disabled",!1).find("span").remove()}}})).init()})},owner.preview=function(t,e){e=$.extend({target:""},e),$(t).on("click",function(){var t=$(e.target).val();t?window.open(t):dialog.msg("请先上传图片!")})},owner.color=function(t,e){e=$.extend({},e),Do("color",function(){$(t).colorpicker(e)})}}(jQuery,window.form={}),function(t,e){(window.show={}).qrcode=function(e,n){n=t.extend({},n),Do("qrcode",function(){t(e).qrcode(n)})}}(jQuery),function(t,e){e.success=function(n){n=t.extend({content:"处理成功",time:6},n,{status:"success"}),e.show(n)},e.warning=function(n){n=t.extend({content:"处理中断",time:6},n,{status:"warning"}),e.show(n)},e.error=function(n){n=t.extend({content:"处理失败",time:6},n,{status:"error"}),e.show(n)},e.show=function(t){UIkit.notification({message:t.content,status:{success:["success","#27ae60"],warning:["warning","#e0690c"],error:["danger","#dd514c"]}[t.status][0],timeout:1e3*t.time})}}(jQuery,window.notify={}),function($,owner){owner.debug=function(t){if(!debug)return!1;"undefined"!=typeof console&&console.log(t)},owner.ajax=function(config){var defaultConfig={async:!0};(config=$.extend(defaultConfig,config)).loading&&dialog.loading(),$.ajax({url:config.url,type:config.type,data:config.data,async:config.async,dataType:"json",beforeSend:function(t){window.source&&t.setRequestHeader("from",window.source)},success:function(t){config.loading&&dialog.loading("",!1),"function"==typeof config.success&&config.success(t.message,t.url)},error:function(e){config.loading&&dialog.loading("",!1);try{var json=eval("("+e.responseText+")"),msg=json.message,url=json.url}catch(e){var msg=null,url=null}""!=msg&&null!=msg||(msg="数据请求失败，请刷新后再试！");{if(404!=e.status)return 401==e.status?"function"==typeof config.login?void config.login(msg):void app.error(msg,url):void(501!=e.status?"function"!=typeof config.error?app.error(msg,url):config.error(msg,url):dialog.confirm({title:msg,callback:[function(){window.postMessage('{"event":"jump", "url":"'+url+'"}'),dialog.close()}]}));app.error("请求操作不存在!")}}})},owner.success=function(t,e){e?window.location.href=e:dialog.msg(t)},owner.error=function(t,e){if(!e)return dialog.msg(t),!1;dialog.confirm({title:t,callback:[function(){window.location.href=e}]})},owner.date=function(t,e){function n(t){return("00"+t).substr(t.length)}e*=1e3;let a=new Date(e);/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));let i={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds()};for(let e in i)if(new RegExp(`(${e})`).test(t)){let a=i[e]+"";t=t.replace(RegExp.$1,1===RegExp.$1.length?a:n(a))}return t}}(jQuery,window.app={});